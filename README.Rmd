---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "README-"
)
```

# bindrcpp [![Travis-CI Build Status](https://travis-ci.org/krlmlr/bindrcpp.svg?branch=master)](https://travis-ci.org/krlmlr/bindrcpp) [![AppVeyor Build Status](https://ci.appveyor.com/api/projects/status/github/krlmlr/bindrcpp?branch=master&svg=true)](https://ci.appveyor.com/project/krlmlr/bindrcpp)


It's easy to create active bindings in R via
[`makeActiveBinding()`](https://www.rdocumentation.org/packages/base/versions/3.3.1/topics/bindenv).
This package faciliates the creation of active bindings that link back to C++ code.
It provides an interface that allows binding several identifiers in an environment
to the same C++ function, which is then called with the name (and a payload) as argument.


## Installation

You can install bindrcpp from github with:

```{r gh-installation, eval = FALSE}
# install.packages("devtools")
devtools::install_github("krlmlr/bindrcpp")
```

## Example

The following C++ module exports a function `test_tolower_bindings()`
that creates active bindings that return the binding name in lowercase.

```{Rcpp}
#include <Rcpp.h>

// [[Rcpp::depends(bindrcpp)]]
#include <bindrcpp.h>

#include <algorithm>
#include <string>

using namespace Rcpp;

SEXP tolower_callback(String name, PAYLOAD) {
  std::string name_string = name;
  std::transform(name_string.begin(), name_string.end(), name_string.begin(), ::tolower);
  return CharacterVector(name_string);
}

// [[Rcpp::export]]
SEXP test_tolower_bindings(CharacterVector names, Environment parent) {
  // A void* can be passed here, but we don't use this functionality here
  PAYLOAD* payload = new PAYLOAD();
  
  return bindrcpp::create_env(
    names, XPtr<GETTER_FUNC_STRING>(new GETTER_FUNC_STRING(&tolower_callback)),
    XPtr<PAYLOAD>(payload), parent);
}
```

This function can be called from R:

```{r example}
env <- test_tolower_bindings(c("Converting", "to", "LOWERCASE"), .GlobalEnv)
ls(env)
env$Converting
env$to
env$LOWERCASE
env$y
```

The bindings are read-only:

```{r failing, error=TRUE}
env$Converting <- "CONVERTING"
```
